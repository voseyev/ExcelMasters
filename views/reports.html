<!-- this include prints out the contents of css.html -->
<include href="views/css.html">

    <title>Reports Page</title>
    </head>

 
    <body>
    <nav class="navbar bg-light navbar-light">
        <h2>Inventory Management</h2>
        <a class="nav-item nav-link" href="/inventory_management/ExcelMasters/editReports"><h4>Edit Reports</h4></a>
        <a class="nav-item nav-link" href="/inventory_management/ExcelMasters/" id="logout">Logout</a>
    </nav>

    <!-- MAIN CONTAINER  -->
    <div class="container" id="maindiv"><!-- TODO change to "container-fluid"  -->
        <div class="row" id="col1">
            <form method="post" action="#" enctype="multipart/form-data">
                <input class="btn btn-default" type="file" name="file" id="myFile">
                <br>
                <input class="btn" type="submit" name="submit" value="Upload" id="submit">
            </form>
        </div>
        <div class="row" id="col2">
            <div class="col">
                <select name="report" id="report">
                    <repeat group="{{@reports}}" value="{{@report}}">
                        <option>{{@report['name']}}</option>
                    </repeat>
                </select>
                <button class="btn btn-default" name="show" id="show">Show</button>
                <hr>
            </div>
        </div>


        <!--Date Picker-->
        <div class="row">
            <div class="col">
                <form action="#" method="post">
                    <input type="date" value="{{@startDate}}" name="startDate" id="startDate" style="margin-left: 350px">
                    <input type="date" value="{{@endDate}}" name="endDate" id="endDate" style="margin-left: 0px">
                    <button onclick="myFunction()" type="submit" name="datesearch" id="dateButton">Search Date</button>
                </form>
                <p id="showDate"></p>
                <p id="showDate2" style="margin-left: 10px"></p>
                <hr>
            </div>
        </div>


        <!--  Report Summary  -->
        <div class="row">
            <div class="col">
                <h4>Total Items: {{@totalItems}}</h4>
                <h5>Items without cost data: {{@totalNoCost}}</h5>
                <h5>{{@startDate}} / {{@endDate}}</h5>
            </div>
            <div class="col-8 table-responsive">
                <table id="table" class="table table-hover">
                    <thead>
                    <tr>
                        <th></th>
                        <th>Winning Bid</th>
                        <th>Consignor Cut</th>
                        <th>Item Cost</th>
                        <th>Profit Margin</th>
                    </tr>
                    </thead>

                    <tbody>
                    <!-- average  -->
                    <tr>
                        <td>Average</td>
                        <td>{{ @avgWin }}</td>
                        <td>{{ @avgCons }}</td>
                        <td>{{ @avgCost }}</td>
                        <td>{{ @avgMargin }}</td>
                    </tr>
                    <!-- total  -->
                    <tr>
                        <td>Total</td>
                        <td>{{ @totalWin }}</td>
                        <td>{{ @totalCons }}</td>
                        <td>{{ @totalCost }}</td>
                        <td>{{ @totalMargin }}</td>
                    </tr>
                    </tbody>
                </table>
            </div>
            <br>
            <hr>
        </div>
        <!-- end Report Summary -->

        <div class="row">
            <div id="chart_div"></div>
        </div>

        <!--  Data table  -->
        <div class="row">
            <table id="datatable" class="table barChart compact table-bordered display">
                <thead>
                <tr>
                    <th data-type="string">Item Number</th>
                    <th data-type="string">Title</th>
                    <th data-type="date">End Date</th>
                    <th data-type="number">Winning Bid</th>
                    <th data-type="number">Pristine Share</th>
                    <th data-type="number">Consignor</th>
                    <th data-type="number">Cost</th>
                    <th data-type="number">Profit Margin</th>
                </tr>

                </thead>
                <tbody>
                <repeat group="{{@data}}" value="{{@row}}">
                    <tr>
                        <td>{{@row['item_num']}}</td>
                        <td>{{@row['title']}}</td>
                        <td>{{@row['end_date']}}</td>
                        <td>{{@row['win']}}</td>
                        <td>{{@row['pristine']}}</td>
                        <td>{{@row['cosignor']}}</td>
                        <td>{{@row['cost']}}</td>
                        <td>{{@row['profit']}}</td>
                    </tr>
                </repeat>

                </tbody>
            </table>
        </div>
    </div><!-- end MAIN CONTAINER  ->



    <!--  JAVASCRIPT  -->
    <!--  jQuery  -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
    <script src="https://code.jquery.com/jquery-1.12.4.js" type="text/javascript"></script>
    <script src="https://cdn.datatables.net/1.10.16/js/jquery.dataTables.min.js" type="text/javascript"
            charset="utf8"></script>
    <script src="https://cdn.datatables.net/1.10.16/js/dataTables.bootstrap4.min.js" type="text/javascript"
            charset="utf8"></script>
    <!--  Bootstrap  -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
    <!--  Google  -->
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <!--  Other  -->
    <script src="js/reports.js"></script>
    <script src="js/chartinator.js" ></script>

    <script type="text/javascript">
        /*
        <repeat group="{{@data}}" value="{{@row}}">
                    <tr>
                        <td>{{@row['item_num']}}</td>
                        <td>{{@row['title']}}</td>
                        <td>{{@row['end_date']}}</td>
                        <td>{{@row['win']}}</td>
                        <td>{{@row['pristine']}}</td>
                        <td>{{@row['cosignor']}}</td>
                        <td>{{@row['cost']}}</td>
                        <td>{{@row['profit']}}</td>
                    </tr>
                </repeat>
         */

        google.charts.load("current", {packages:["corechart"]});
        google.charts.setOnLoadCallback(drawChart);
        // create ethnicity pie chart
        function drawChart() {
            // send to data table
            //repeat statement causes errors in phpStorm but is correct as is
            var data = google.visualization.arrayToDataTable([
                ['Title', 'Win']
                <repeat group="{{@data}}" value="{{@row}}">
                    ,['{{ @row["title"] }}', {{ @row['win'] }}]
                </repeat>
            ]);
            // customize chart
            var options = {  //TODO change chart style
                title: 'Summary',
                is3D: true
            };
            // draw chart at id
            var chart = new google.visualization.BarChart(document.getElementById('chart_div'));
            chart.draw(data, options);
        }
    </script>

    </body>
    </html>
